---
import Layout from "../../../layouts/Layout.astro";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import { getCollection } from "astro:content";
import Comments from "../../../components/Comments.astro";

export async function getStaticPaths() {
  const entries = await getCollection("tech");
  return entries
    .filter((entry) => !entry.data.draft)
    .map((entry) => ({
      params: { slug: entry.slug },
      props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.description ?? entry.data.title}>
  <Header />
  <main id="main-content" class="mx-auto max-w-3xl px-6 py-12">
    <article class="prose max-w-none prose-headings:text-gray-900 prose-p:text-gray-700">
      <header class="not-prose mb-8">
        <p class="text-sm text-gray-500">
          <time datetime={entry.data.date.toISOString()}>
            {entry.data.date.toLocaleDateString("ja-JP")}
          </time>
        </p>
        <h1 class="mt-2 text-3xl font-semibold text-gray-900">
          {entry.data.title}
        </h1>
        {entry.data.description && (
          <p class="mt-2 text-gray-600">{entry.data.description}</p>
        )}
        {entry.data.tags && entry.data.tags.length > 0 && (
          <ul class="mt-3 flex flex-wrap gap-2">
            {entry.data.tags.map((tag) => (
              <li class="text-xs rounded-full bg-gray-100 px-2 py-1 text-gray-600">
                {tag}
              </li>
            ))}
          </ul>
        )}
      </header>
      <Content />
    </article>
    <br><br>
    <Comments />
  </main>
  <Footer />
</Layout>
